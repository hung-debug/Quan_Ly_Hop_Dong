
<meta name='viewport' content='width=device-width' />

<div class="sample-contract row" *ngIf="loaded && valid && this.mobile === false">
  <div class="col-md-3 sample-contract__information" style="background-color: white;">
    <div class="sample-contract__information--drag" id="width-element-info" style="margin-top: 15px">
      <div style="padding-bottom: 10px; text-align: center; font-weight: bold" class="label">{{'contract.detail' | translate}}</div>
      <div style="line-height: 25px">
        <div>
          <span class="title-contract">{{'contract.uid' | translate}}:</span>
          <span>{{datas?.is_data_contract?.contract_uid}}</span>
        </div>
        <div>
          <span class="title-contract">{{'menu.contract.type.list' | translate}}:</span>
          <span>{{datas?.is_data_contract?.type_name}}</span>
        </div>
        <div>
          <span class="title-contract">{{'contract.name' | translate}}:</span>
          <span>{{datas.is_data_contract.name}}</span>
        </div>
        <div>
          <span class="title-contract">{{'contract.number' | translate}}:</span>
          <span>{{datas.is_data_contract.contract_no}}</span>
        </div>
        <div>
          <span class="title-contract">{{'file.attach' | translate}}:</span>
          <span *ngFor="let d of allFileAttachment;let i = index">
            <span *ngIf="i != 0">, </span>
            <a rel="noopener noreferrer" style="color: #106DB6" rel="stylesheet" [href]="d.path.includes('.txt') ? d.path : d.path.replace('/tmp/','/tmp/v2/')" target="_blank">{{d.filename}}</a>
          </span>
        </div>
        <div>
          <span class="title-contract">{{'contract.connect' | translate}}:
          </span>
          <span *ngFor="let d of datas?.is_data_contract?.refs;let i = index">
            <span *ngIf="i != 0">, </span>
            <a style="color: #106DB6;"  [href]="d.path" target="_blank" (click)="openPdf(d.path, $event)">{{d.ref_name}}</a>
          </span>
        </div>

      </div>
    </div>
    <hr>

    <div class="location-change">
      <div class="sample-contract__information--user-sign" style="line-height: 25px">
        <div style="text-align: center; font-weight: bold" class="label">{{'relate.party' | translate}}</div>

        <div *ngFor="let d of this.datas?.is_data_contract?.participants">
          <div *ngIf="d.type != 3">{{d.name}}</div>
          <div *ngIf="d.type == 3">{{d.recipients[0].name}}</div>
        </div>

      </div>
      <div>
        <u style="color: #106DB6; padding-right: 3px; cursor: pointer" (click)="processHandleContract()">{{'contract_processing_flow' | translate}}</u>
      </div>
      <hr>

      <div class="flex-column" *ngIf="![2,3].includes(recipient.status)">
        <div class="label" style="text-align: center; font-weight: bold;" *ngIf="this.datas.roleContractReceived == 2 && this.isDataContract.release_state== 'CON_HIEU_LUC'">
          <p class="d-flex justify-content-center mb-4">XEM XÉT HỢP ĐỒNG</p>
          <p class="d-flex mb-2 text-align-left mx-3">{{'content.confirm' | translate}}</p>
          <div class="confirm-radio d-flex justify-content-between mx-4">
            <div class="radio-confirm">
              <input id="radio-confirm-consider" type="radio" name="confirm-radio-consider" [value]="1" [(ngModel)]="confirmConsider">
              <label for="radio-confirm-consider" class="ms-2">{{'btn.accept' | translate}}</label>
            </div>
            <div class="radio-refuse">
              <input id="radio-refuse-consider" type="radio" name='confirm-radio-consider' [value]="2" [(ngModel)]="confirmConsider">
              <label for="radio-refuse-consider" class="ms-2">{{'btn.not.accept' | translate}}</label>
            </div>
          </div>
        </div>
        <div class="label" style="text-align: center; font-weight: bold;" *ngIf="(this.datas.roleContractReceived == 3 || this.datas.roleContractReceived == 4) && this.isDataContract.release_state == 'CON_HIEU_LUC'">
          <p class="d-flex justify-content-center mb-4 text-uppercase">{{'contract.sign.confirm' | translate}}</p>
          <p class="d-flex mb-2 text-align-left mx-3">{{'content.confirm' | translate}}</p>
          <div class="confirm-radio d-flex justify-content-between mx-4">
            <div class="radio-confirm">
              <input id="radio-confirm-secretary" type="radio" name="confirm-radio-secretary" [value]="1" [(ngModel)]='confirmSignature'>
              <label for="radio-confirm-secretary" class="ms-2">{{'btn.accept' | translate}}</label>
            </div>
            <div class="radio-refuse">
              <input id="radio-refuse-secretary" type="radio" name='confirm-radio-secretary' [value]="2" [(ngModel)]='confirmSignature'>
              <label for="radio-refuse-secretary" class="ms-2">{{'btn.not.accept' | translate}}</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div (scroll)="scroll($event)" id="pdf-full" class="col-md-9 sample-contract__file viewer-pdf isDrag"
       style="background-color: #F2F2F2; position: relative">
    <div id="pdf-viewer-step-3">
      <div *ngFor="let d of this.convertToSignConfig()" class="show-list-name-drag" [style.width]="this.canvasWidth">
        <div class="resize-drag not-out-drop" *ngIf="![2,3].includes(recipient.status)"
             [id]="d.id"
             style="z-index: -1;"
             #itemElement
             (click)="getSignSelect(d)"
             [ngClass]="changeColorDrag(null, d, true)"
             [ngStyle]="changePosition(d,null,null,'#EBF8FF')">
          <app-image-sign-contract 
            [ngClass]="(d.sign_unit == 'chu_ky_so' || d.sign_unit == 'chu_ky_anh') ? 'main-sign-box': ''"  
            id="image-sign-contract" 
            (contractNoValue)="contractNoValueChange($event)" 
            [contractNoValue]="contractNoValue"
            [contractNoValueSign]="contractNoValueSign"
            [otpValueSign]="otpValueSign"
            (checkedChange)="switchesValueChange($event)" 
            *ngIf="![2,3].includes(recipient.status)" 
            [datas]="datas" [view]="[2,3].includes(recipient.status)" 
            [sign]="d"
            [isNotTextSupport]="isNotTextSupport"
          >
          </app-image-sign-contract>
          <div *ngIf="this.flagFocus && d.sign_unit == 'text'" class="name-sig-img-daky long-text-ellipsis">{{(d.recipient && !d.valueSign) ? d.recipient.name : ''}}</div>
          <div *ngIf="d.sign_unit != 'text' && !this.flagFocus && !this.otpValueSign" class="name-sig-img-daky long-text-ellipsis">{{(d.recipient && !d.valueSign) ? d.recipient.name : ''}}</div>
        </div>
      </div>
      <div class="skeleton-sign position-absolute opacity-0">
        <app-display-digital-signature [nameCompany]="nameCompany" [cardId]="cardId" [phonePKI]="phonePKI" [srcMark]="srcMark" [isDateTime]="isDateTime"></app-display-digital-signature>
      </div>
      <div class="skeleton-sign position-absolute opacity-0">
        <app-text-signature-image [font]="font" [font_size]="font_size" [datas]="datas" [textSign]="textSign" [width]="width"></app-text-signature-image>
      </div>
    </div>
  </div>
</div>

<div *ngIf="this.mobile && !this.multiSignInPdf">

      <div style="margin:auto;padding: 10px">
        <pdf-viewer *ngIf="![2,3].includes(recipient.status)" [src]="pdfSrcMobile"
        [render-text]="true"
        style="width: 95%; height: calc(70vh); border: 1px;"
        [fit-to-page]="true"
        [show-borders]="true"
        [show-all]="true"
        [(page)]="pageMobile"
        [stick-to-page]="true"
        (after-load-complete)="afterLoadComplete($event)"
        (pagechanging)="pagechanging($event)"
        ></pdf-viewer>
      </div>

    <div class="flex-column" style="text-align: center;margin-top: 2px;">
      <button class="call-page" (click)="firstPageMobile()">
        <img width="14px" height="18px" *ngIf="this.page1" src="assets/img/previousbold.svg">
        <img width="14px" height="18px" *ngIf="!this.page1" src="assets/img/firstpage.svg">
      </button>
      <button class="call-page1" (click)="previousPageMobile()">
        <img width="10px" height="14px" *ngIf="this.page1" src="assets/img/firstpagebold.svg">
        <img width="10px" height="14px" *ngIf="!this.page1" src="assets/img/previous.svg">
      </button>

      <input class="input-mobile" [(ngModel)]="pageMobile" type="text"/>&nbsp;/ &nbsp;{{this.pageNumber}}

      <button class="call-page1" id="prev" (click)="onNextPageMobile()">
        <img width="10px" height="14px" *ngIf="this.pageLast" src="assets/img/next.svg">
        <img width="10px" height="14px" *ngIf="!this.pageLast" src="assets/img/nextblur.svg">
      </button>

      <button class="call-page1" id="prev" (click)="lastPageMobile()">
        <img width="14px" height="18px" *ngIf="this.pageLast" src="assets/img/lastpage.svg">
        <img width="14px" height="18px" *ngIf="!this.pageLast" src="assets/img/lastpageblur.svg">
      </button>
    </div>

    <div style="display: none;" *ngFor="let d of this.convertToSignConfig()" class="show-list-name-drag" [style.width]="this.canvasWidth">
      <app-image-sign-contract id="image-sign-contract-mobile" *ngIf="![2,3].includes(recipient.status)" [datas]="datas" [view]="[2,3].includes(recipient.status)" [sign]="d"></app-image-sign-contract>
    </div>

    <div style="position: absolute;top: -1000px">
      <app-display-digital-signature [nameCompany]="nameCompany" [cardId]="cardId" [phonePKI]="phonePKI" [srcMark]="srcMark" [isDateTime]="isDateTime"></app-display-digital-signature>
    </div>

    <div class="flex-column" *ngIf="![2,3].includes(recipient.status)" style="margin-top: 5px">
      <div class="label" style="text-align: center; font-weight: bold;" *ngIf="this.datas.roleContractReceived == 2 && this.isDataContract.release_state == 'CON_HIEU_LUC'">
        <p class="d-flex justify-content-center mb-4">{{'contract.review' | translate}}</p>
        <p class="d-flex mb-2 text-align-left mx-3">{{'content.confirm' | translate}}</p>
        <div class="confirm-radio d-flex justify-content-between mx-4">
          <div class="radio-confirm">
            <input id="radio-confirm-consider" type="radio" name="confirm-radio-consider" [value]="1" [(ngModel)]="confirmConsider">
            <label for="radio-confirm-consider" class="ms-2">{{'btn.accept' | translate}}</label>
          </div>
          <div class="radio-refuse">
            <input id="radio-refuse-consider" type="radio" name='confirm-radio-consider' [value]="2" [(ngModel)]="confirmConsider">
            <label for="radio-refuse-consider" class="ms-2">{{'btn.not.accept' | translate}}</label>
          </div>
        </div>
      </div>
      <div class="label" style="text-align: center; font-weight: bold;" *ngIf="(this.datas.roleContractReceived == 3 || this.datas.roleContractReceived == 4) && this.isDataContract.release_state == 'CON_HIEU_LUC'">
        <p class="d-flex justify-content-center mb-4 text-uppercase">{{'contract.sign.confirm' | translate}}</p>
        <p class="d-flex mb-2 text-align-left mx-3">{{'content.confirm' | translate}}</p>
        <div class="confirm-radio d-flex justify-content-between mx-4">
          <div class="radio-confirm">
            <input id="radio-confirm-secretary" type="radio" name="confirm-radio-secretary" [value]="1" [(ngModel)]='confirmSignature'>
            <label for="radio-confirm-secretary" class="ms-2">{{'btn.accept' | translate}}</label>
          </div>
          <div class="radio-refuse">
            <input id="radio-refuse-secretary" type="radio" name='confirm-radio-secretary' [value]="2" [(ngModel)]='confirmSignature'>
            <label for="radio-refuse-secretary" class="ms-2">{{'btn.not.accept' | translate}}</label>
          </div>
        </div>
      </div>
    </div>
</div>

<app-footer-signature *ngIf="loaded  && (!this.mobile || (this.mobile && !this.multiSignInPdf))" 
  [pageNum]="pageNum" 
  [pageLast]="pageLast" 
  [page1]="page1" 
  [pageNumber]="pageNumber" 
  [thePDF]="thePDF" 
  [idElement]="idElement" 
  [coordinateY]="coordinateY" 
  [confirmSignature]="confirmSignature" 
  [signBoxData]="signBoxData"
  [datas]="datas" 
  [view]="[2,3].includes(recipient.status)" 
  [recipientId]="recipientId" 
  [pageBefore]="pageBefore"
  [status]="status"
  (submitChanges)="submitEvents($event)"
></app-footer-signature>
<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#fff"
  type="ball-spin-clockwise"
>
  <p style="font-size: 18px; color: white; text-align: center;white-space: pre-line;">{{loadingText}}</p>
</ngx-spinner>


 
