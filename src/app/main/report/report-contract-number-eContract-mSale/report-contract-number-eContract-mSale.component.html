<p-selectButton [options]="stateOptions" [(ngModel)]="isReport" optionLabel="label" optionValue="value"
  (click)="changeTab()">
  <ng-template #options let-item>
    <span style="margin: auto;width: 50%;">{{item.label | translate}}</span>
  </ng-template>
</p-selectButton>

<div style="padding-top: 20px;">
  <div class="row">
    <!--Tổ chức-->
    <div class="col-md-2">
      <div>{{'organization' | translate}}</div>
      <div class="input-line">
        <p-treeSelect #nameContract [(ngModel)]="selectedNodeOrganization" [filter]="true" filterBy="name"
          [droppable]="true" [options]="listOrgCombobox" (onNodeSelect)="changeOrg()">
        </p-treeSelect>
      </div>
    </div>

    <!--Ngày hoàn thành hợp đồng-->
    <div class="col-md-2">
        <div>{{'completed-date' | translate}} <span style="color: red"> *</span></div>
        <div class="input-line">
            <p-calendar selectionMode="range" [readonlyInput]="false" [(ngModel)]="date" [showIcon]="true" dateFormat="dd/mm/yy"></p-calendar>
        </div>
    </div>

    <!--Loại hợp đồng-->
    <div class="col-md-3" *ngIf="this.isReport == 'off'">
      <div>{{'contract.group' | translate}}</div>
      <div class="input-line">
        <p-multiSelect panelStyleClass="font" appendTo="body" [options]="typeList" [(ngModel)]="type_id"
          optionLabel="name" optionValue="id" placeholder="Chọn loại hợp đồng" [filter]="true" filterBy="name"
          [showClear]="true" [multiple]="true" display="chip">
        </p-multiSelect>
      </div>
    </div>

    <!--Loại hợp đồng-->
    <div class="col-md-3" *ngIf="this.isReport == 'on'">
      <div>{{'contract.group' | translate}}</div>
      <div class="input-line">
        <p-multiSelect panelStyleClass="font" appendTo="body" [options]="typeListDetail" [(ngModel)]="type_id_detail"
          optionLabel="name" optionValue="id" placeholder="Chọn loại hợp đồng" [filter]="true" filterBy="name"
          [showClear]="true" [multiple]="true" display="chip">
        </p-multiSelect>
      </div>
    </div>

    <!--Button-->
    <div class="col-md-4 btn_search" *ngIf="this.isReport == 'off'">
      <button class="btn btn-lg btn-block btn_submit" (click)="export(false)">{{'btn.report' | translate }}</button>
      <button class="btn btn-lg btn-block btn_submit" (click)="export(true)">Export</button>
    </div>

    <div class="col-md-4 btn_search" *ngIf="this.isReport == 'on'">
      <button class="btn btn-lg btn-block btn_submit" (click)="exportDetail(false)">{{'btn.report' | translate
        }}</button>
      <button class="btn btn-lg btn-block btn_submit" (click)="exportDetail(true)">Export</button>
    </div>
  </div>

  <!--Bảng dữ liệu báo cáo tổng quan-->
  <div class="row" style="padding-top: 20px;" *ngIf="this.isReport == 'off'">
    <p-table #dt [value]="list" [paginator]="true" [rows]="4" id="table" [autoLayout]="true"
      [totalRecords]="this.totalRecords" [(first)]="this.first">

      <!--header-->
      <ng-template pTemplate="header">
        <!--header 1-->
        <tr>
          <th *ngFor="let col of cols" [style]='col.style' [colSpan]="col.colspan" [rowSpan]="col.rowspan">
            {{col.header | translate}}
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-list let-row="rowIndex">
        <tr style="background-color: #EEF7FF;">
          <!-- <td style="font-style: normal;font-weight: 800;font-size: 13px;">{{list.orgName}}</td>
          <td></td> -->
          {{list.orgName}}
        </tr>

        <tr *ngFor="let data of list.data">
          <td>{{data.name}}</td>
          <td style="font-weight: bold;">{{ data.na ? data.na : data.quantity}}</td>
        </tr>

      </ng-template>

      <!-- <ng-template pTemplate="paginatorleft" let-state>
          <span style="color: white !important;">{{'chart.number' | translate}}: {{state.totalRecords > 0 ? state.first+1 : state.first}} - {{(state.first+state.rows)> state.totalRecords ? state.totalRecords : state.first+state.rows}} / {{state.totalRecords}}</span>
        </ng-template>
        <ng-template pTemplate="paginatorright" let-state>
          <span style="color: #0160AE !important;">{{'chart.number' | translate}}: {{state.totalRecords > 0 ? state.first+1 : state.first}} - {{(state.first+state.rows)> state.totalRecords ? state.totalRecords : state.first+state.rows}} / {{state.totalRecords}}</span>
        </ng-template> -->

      <!-- new version pagination -->

      <ng-template pTemplate="paginatorleft" let-state>
        <span style="color: white !important;">{{'chart.number' | translate}}: {{(state.totalRecords <= 0 || state.fisrt
            <=0) ? 0 : state.first+1}} - {{(state.first+state.rows)> state.totalRecords ? state.totalRecords :
            state.first+state.rows}} / {{state.totalRecords}}</span>
      </ng-template>
      <ng-template pTemplate="paginatorright" let-state>
        <span style="color: #0160AE !important;">{{'chart.number' | translate}}: {{(state.totalRecords <= 0 ||
            state.fisrt <=0) ? 0 : state.first+1}} - {{(state.first+state.rows)> state.totalRecords ? state.totalRecords
            : state.first+state.rows}} / {{state.totalRecords}}</span>
      </ng-template>
    </p-table>
  </div>

  <!--Bảng dữ liệu báo cáo chi tiết-->
  <div class="row" style="padding-top: 20px;" *ngIf="this.isReport == 'on'">
    <p-table #dt [value]="listDetail" [paginator]="true" [rows]="4" id="table" [autoLayout]="true"
      [totalRecords]="this.totalRecords" [(first)]="this.first">

      <!--header-->
      <ng-template pTemplate="header">
        <!--header 1-->
        <tr>
          <th *ngFor="let col of colsDetail" [style]='col.style' [colSpan]="col.colspan" [rowSpan]="col.rowspan">
            {{col.header | translate}}
          </th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-listDetail let-row="rowIndex">
        <tr style="background-color: #EEF7FF;">
          <td colspan="11" style="font-style: normal;font-weight: 800;font-size: 13px;">{{listDetail.orgName}}</td>

        </tr>

        <tr *ngFor="let data of listDetail.data">
          <td class="row-word">{{data.name}}</td>
          <td class="row-word">{{data.typeName}}</td>
          <td class="row-word" *ngIf="data.groupId == 1 || data.groupId == null">Khác</td>
          <td class="row-word" *ngIf="data.groupId == 2">Công nghệ thông tin</td>
          <!-- <td class="row-word" *ngIf="data.groupId == ''"></td> -->
          <td class="row-word">{{data.contractNo}}</td>
          <td class="row-word">{{data.code}}</td>
          <td class="row-word">{{this.convertTime(data.createdAt)}}</td>
          <td class="row-word">{{this.convertTime(data.signTime)}}</td>
          <td class="row-word" *ngIf="data.status == 'SIGNED'">{{"contract.status.complete"| translate}}</td>
          <td class="row-word">{{data.organization}}</td>
          <td class="row-word">{{data.createdBy}}</td>
        </tr>

      </ng-template>
      <!-- new version pagination -->

      <ng-template pTemplate="paginatorleft" let-state>
        <span style="color: white !important;">{{'chart.number' | translate}}: {{(state.totalRecords <= 0 || state.fisrt
            <=0) ? 0 : state.first+1}} - {{(state.first+state.rows)> state.totalRecords ? state.totalRecords :
            state.first+state.rows}} / {{state.totalRecords}}</span>
      </ng-template>
      <ng-template pTemplate="paginatorright" let-state>
        <span style="color: #0160AE !important;">{{'chart.number' | translate}}: {{(state.totalRecords <= 0 ||
            state.fisrt <=0) ? 0 : state.first+1}} - {{(state.first+state.rows)> state.totalRecords ? state.totalRecords
            : state.first+state.rows}} / {{state.totalRecords}}</span>
      </ng-template>
    </p-table>
  </div>
</div>

<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="medium" color="#fff" type="ball-spin-clockwise">
  <p style="font-size: 18px; color: white">{{'sys.processing' | translate}}...</p>
</ngx-spinner>
